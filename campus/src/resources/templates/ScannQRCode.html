<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<h1>QR Code Scanner</h1>
<video id="qr-video" width="300" height="300" autoplay></video>
<div id="qr-result"></div>

<script src="https://cdn.jsdelivr.net/npm/jsqr@2.0.1/dist/jsQR.js"></script>
<script>
    const video = document.getElementById('qr-video');
    const resultContainer = document.getElementById('qr-result');

    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
        .then(stream => {
            video.srcObject = stream;
            video.play();
            scanQRCode();
        })
        .catch(err => {
            console.error('Error accessing camera:', err);
        });

    function scanQRCode() {
        const canvas = document.createElement('canvas');
        const context = canvas.getContext('2d');
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        setInterval(() => {
            context.drawImage(video, 0, 0, canvas.width, canvas.height);
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);

            if (code) {
                resultContainer.innerText = 'QR Code 数据：' + code.data;

                // 将数据发送到后端进行验证
                validateQRCode(code.data);
            } else {
                resultContainer.innerText = '未扫描到 QR Code';
            }
        }, 1000);
    }

    function validateQRCode(qrCodeData) {
        // 发送数据到后端的接口进行验证
        fetch('/validateQRCode?qrCodeData=' + encodeURIComponent(qrCodeData))
            .then(response => response.text())
            .then(result => {
                console.log(result);
                // 在此处处理后端返回的验证结果
            })
            .catch(error => {
                console.error('Error validating QR Code:', error);
            });
    }
</script>
</body>
</html>